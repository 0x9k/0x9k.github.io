<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>syzkaller_source_read_syscall_type_and_function | 0x9k</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="本文摘要—— syzkaller_source_read_syscall_type_and_function">
<meta name="keywords" content="syzkaller,fuzzer">
<meta property="og:type" content="article">
<meta property="og:title" content="syzkaller_source_read_syscall_type_and_function">
<meta property="og:url" content="https://0x9k.club/posts/uncategorized/2018-05-02-syzkaller_source_read_syscall_type_and_function.html">
<meta property="og:site_name" content="0x9k">
<meta property="og:description" content="本文摘要—— syzkaller_source_read_syscall_type_and_function">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2018-05-02T15:38:06.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="syzkaller_source_read_syscall_type_and_function">
<meta name="twitter:description" content="本文摘要—— syzkaller_source_read_syscall_type_and_function">
  
    <link rel="alternate" href="/atom.xml" title="0x9k" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">0x9k</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://0x9k.club"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-syzkaller_source_read_syscall_type_and_function" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/posts/uncategorized/2018-05-02-syzkaller_source_read_syscall_type_and_function.html" class="article-date">
  <time datetime="2018-05-02T15:38:06.000Z" itemprop="datePublished">2018-05-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      syzkaller_source_read_syscall_type_and_function
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="本文摘要——"><a href="#本文摘要——" class="headerlink" title=" 本文摘要——   "></a><strong> 本文摘要—— syzkaller_source_read_syscall_type_and_function </strong> <excerpt in="" index="" |="" 首页:摘要=""></excerpt></h1><a id="more"></a>
<the rest="" of="" contents="" |="" 余下全文="">


<h2 id="syzkaller源码阅读之系统调用相关的类型和函数"><a href="#syzkaller源码阅读之系统调用相关的类型和函数" class="headerlink" title="syzkaller源码阅读之系统调用相关的类型和函数"></a>syzkaller源码阅读之系统调用相关的类型和函数</h2><h3 id="系统调用相关的类型"><a href="#系统调用相关的类型" class="headerlink" title="系统调用相关的类型"></a>系统调用相关的类型</h3><p>系统调用描述类型Syscall定义:包含系统调用号NR、系统调用参数类型和返回值类型等<br>在prog/types.go中定义</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Syscall <span class="keyword">struct</span> &#123;</span><br><span class="line">	ID       <span class="keyword">int</span>            <span class="comment">//ID也是系统调用号</span></span><br><span class="line">	NR       <span class="keyword">uint64</span>         <span class="comment">//系统调用号</span></span><br><span class="line">	Name     <span class="keyword">string</span>         <span class="comment">//名字</span></span><br><span class="line">	CallName <span class="keyword">string</span>         <span class="comment">//函数调用名</span></span><br><span class="line">	Args     []Type         <span class="comment">//系统调用参数类型切片数组</span></span><br><span class="line">	Ret      Type           <span class="comment">//系统调用返回值类型</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>完整的系统调用类型:Syscall中只包含了系统调用参数的类型和返回值类型<br>prog/prog.go中定义</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Call <span class="keyword">struct</span> &#123;</span><br><span class="line">	Meta *Syscall</span><br><span class="line">	Args []Arg              <span class="comment">//系统调用参数值切片数组</span></span><br><span class="line">	Ret  Arg                <span class="comment">//系统调用返回值</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="系统调用的参数"><a href="#系统调用的参数" class="headerlink" title="系统调用的参数"></a>系统调用的参数</h3><h4 id="系统调用参数模式"><a href="#系统调用参数模式" class="headerlink" title="系统调用参数模式"></a>系统调用参数模式</h4><p>系统调用参数模式分为:输入参数、输出参数、即是输入也是输出参数<br>在prog/types.go中定义</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Dir <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//定义参数模式</span></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	DirIn Dir = <span class="literal">iota</span>         <span class="comment">//0 输入参数</span></span><br><span class="line">	DirOut                  <span class="comment">//1 输出参数</span></span><br><span class="line">	DirInOut               <span class="comment">//2 即是输入参数也是输出参数</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>以字符串形式返回系统调用参数模式:输入参数——in、输出参数——out、即是输入参数也是输出参数——inout<br>在prog/types.go中定义</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(dir Dir)</span> <span class="title">String</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">	<span class="keyword">switch</span> dir &#123;</span><br><span class="line">	<span class="keyword">case</span> DirIn:</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"in"</span></span><br><span class="line">	<span class="keyword">case</span> DirOut:</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"out"</span></span><br><span class="line">	<span class="keyword">case</span> DirInOut:</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"inout"</span></span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		<span class="built_in">panic</span>(<span class="string">"unknown dir"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="系统调用参数类型接口"><a href="#系统调用参数类型接口" class="headerlink" title="系统调用参数类型接口"></a>系统调用参数类型接口</h4><h5 id="系统调用参数接口"><a href="#系统调用参数接口" class="headerlink" title="系统调用参数接口"></a>系统调用参数接口</h5><p>参数类型接口需要实现两个方法:返回参数的类型——Type()和参数的大小——Size()<br>prog/prog.go中定义</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Arg <span class="keyword">interface</span> &#123;</span><br><span class="line">	Type() Type             <span class="comment">//返回参数的类型</span></span><br><span class="line">	Size() <span class="keyword">uint64</span>           <span class="comment">//返回参数的大小</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="系统调用参数类型接口-1"><a href="#系统调用参数类型接口-1" class="headerlink" title="系统调用参数类型接口"></a>系统调用参数类型接口</h5><p>参数类型接口需要实现如下几个方法:<br>prog/types.go中定义</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Type <span class="keyword">interface</span> &#123;</span><br><span class="line">	String() <span class="keyword">string</span></span><br><span class="line">	Name() <span class="keyword">string</span></span><br><span class="line">	FieldName() <span class="keyword">string</span></span><br><span class="line">	Dir() Dir</span><br><span class="line">	Optional() <span class="keyword">bool</span></span><br><span class="line">	Default() <span class="keyword">uint64</span></span><br><span class="line">	Varlen() <span class="keyword">bool</span></span><br><span class="line">	Size() <span class="keyword">uint64</span></span><br><span class="line">	BitfieldOffset() <span class="keyword">uint64</span></span><br><span class="line">	BitfieldLength() <span class="keyword">uint64</span></span><br><span class="line">	BitfieldMiddle() <span class="keyword">bool</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="通用参数类型类型"><a href="#通用参数类型类型" class="headerlink" title="通用参数类型类型"></a>通用参数类型类型</h5><p>定义通用参数类型:只包含一个成员变量,参数接口类型Type<br>prog/prog.go中定义</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> ArgCommon <span class="keyword">struct</span> &#123;</span><br><span class="line">	typ Type</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>实现参数接口的Type方法<br>prog/prog.go中定义</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(arg *ArgCommon)</span> <span class="title">Type</span><span class="params">()</span> <span class="title">Type</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> arg.typ</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="具体的参数类型"><a href="#具体的参数类型" class="headerlink" title="具体的参数类型"></a>具体的参数类型</h3><p>具体参数类型可以分为一下几个:Const类型参数、指针类型和vma类型的参数、Data类型的参数、Group类型的参数(结构体和数组)、Union类型的参数(联合共用体类型)和Resource类型的参数<br>每一参数类型都包含一个成员变量——通用的参数类型ArgCommon</p>
<h4 id="Const类型的参数"><a href="#Const类型的参数" class="headerlink" title="Const类型的参数"></a>Const类型的参数</h4><p>Const类型的参数包括下面几个:ConstType,IntType,FlagsType,LenType,ProcType,CsumType和ResourceType</p>
<p>定义Const类型的参数:Const类型包含Const类型——常量、IntType——int类型、FlagsType——在系统调用中用来表示Flags、LenType——长度、Resource——资源类型、ProcType和CsumType<br>prog/prog.go中定义</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> ConstArg <span class="keyword">struct</span> &#123;</span><br><span class="line">	ArgCommon               <span class="comment">//通用参数类型</span></span><br><span class="line">	Val <span class="keyword">uint64</span>              <span class="comment">//参数的值</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>实现Const类型参数的Size()接口方法<br>prog/prog.go中定义</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(arg *ConstArg)</span> <span class="title">Size</span><span class="params">()</span> <span class="title">uint64</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> arg.typ.Size()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>实现Const类型的参数返回其值:判断Const类型参数具体是哪一个，并返回其值——第一个是值、第二个是和处理器proc相关、第三个是否为大端模式<br>prog/prog.go中实现</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(arg *ConstArg)</span> <span class="title">Value</span><span class="params">()</span> <span class="params">(<span class="keyword">uint64</span>, <span class="keyword">uint64</span>, <span class="keyword">bool</span>)</span></span> &#123;</span><br><span class="line">	<span class="comment">//判断Const参数类型</span></span><br><span class="line">	<span class="keyword">switch</span> typ := (*arg).Type().(<span class="keyword">type</span>) &#123;</span><br><span class="line">	<span class="comment">//int类型</span></span><br><span class="line">	<span class="keyword">case</span> *IntType:</span><br><span class="line">		<span class="keyword">return</span> arg.Val, <span class="number">0</span>, typ.BigEndian</span><br><span class="line">	<span class="comment">//const类型	</span></span><br><span class="line">	<span class="keyword">case</span> *ConstType:</span><br><span class="line">		<span class="keyword">return</span> arg.Val, <span class="number">0</span>, typ.BigEndian</span><br><span class="line">	<span class="comment">//flags类型	</span></span><br><span class="line">	<span class="keyword">case</span> *FlagsType:</span><br><span class="line">		<span class="keyword">return</span> arg.Val, <span class="number">0</span>, typ.BigEndian</span><br><span class="line">	<span class="comment">//len类型	</span></span><br><span class="line">	<span class="keyword">case</span> *LenType:</span><br><span class="line">		<span class="keyword">return</span> arg.Val, <span class="number">0</span>, typ.BigEndian</span><br><span class="line">	<span class="comment">//csum类型	</span></span><br><span class="line">	<span class="keyword">case</span> *CsumType:</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>, <span class="number">0</span>, <span class="literal">false</span></span><br><span class="line">	<span class="comment">//Resource资源类型	</span></span><br><span class="line">	<span class="keyword">case</span> *ResourceType:</span><br><span class="line">		t := typ.Desc.Type.(*IntType)</span><br><span class="line">		<span class="keyword">return</span> arg.Val, <span class="number">0</span>, t.BigEndian</span><br><span class="line">	<span class="comment">//Proc类型	</span></span><br><span class="line">	<span class="keyword">case</span> *ProcType:</span><br><span class="line">		<span class="keyword">if</span> arg.Val == typ.Default() &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="number">0</span>, <span class="number">0</span>, <span class="literal">false</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> typ.ValuesStart + arg.Val, typ.ValuesPerProc, typ.BigEndian</span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		<span class="built_in">panic</span>(fmt.Sprintf(<span class="string">"unknown ConstArg type %#v"</span>, typ))</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="指针类型和vma类型的参数"><a href="#指针类型和vma类型的参数" class="headerlink" title="指针类型和vma类型的参数"></a>指针类型和vma类型的参数</h4><p>定义指针类型的参数<br>prog/prog.go中定义</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> PointerArg <span class="keyword">struct</span> &#123;</span><br><span class="line">	ArgCommon</span><br><span class="line">	Address <span class="keyword">uint64</span>              <span class="comment">//指针地址</span></span><br><span class="line">	VmaSize <span class="keyword">uint64</span>              <span class="comment">//vma大小</span></span><br><span class="line">	Res     Arg                 <span class="comment">//指针指向的对象</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>判断指针是否为空:指针地址是否为空、vma大小是否为空、指针指向的对象是否为nil<br>prog/prog.go中定义</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(arg *PointerArg)</span> <span class="title">IsNull</span><span class="params">()</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> arg.Address == <span class="number">0</span> &amp;&amp; arg.VmaSize == <span class="number">0</span> &amp;&amp; arg.Res == <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>实现参数接口Size()——返回参数大小<br>prog/prog.go中定义</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(arg *PointerArg)</span> <span class="title">Size</span><span class="params">()</span> <span class="title">uint64</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> arg.typ.Size()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Data类型的参数"><a href="#Data类型的参数" class="headerlink" title="Data类型的参数"></a>Data类型的参数</h4><p>定义Data类型的参数<br>prog/prog.go中定义</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> DataArg <span class="keyword">struct</span> &#123;</span><br><span class="line">	ArgCommon</span><br><span class="line">	data []<span class="keyword">byte</span>                <span class="comment">//切片数组用来保存输入in/输入输出inout参数</span></span><br><span class="line">	size <span class="keyword">uint64</span>                <span class="comment">//data大小</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>实现Data参数类型的Size()接口方法——返回参数大小<br>prog/prog.go中定义</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(arg *DataArg)</span> <span class="title">Size</span><span class="params">()</span> <span class="title">uint64</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(arg.data) != <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">uint64</span>(<span class="built_in">len</span>(arg.data))</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> arg.size</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>实现Data参数类型的Data()方法——返回参数数据信息(只能是输入参数模式或者输入输出模式的参数)<br>prog/prog.go中定义</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(arg *DataArg)</span> <span class="title">Data</span><span class="params">()</span> []<span class="title">byte</span></span> &#123;</span><br><span class="line">	<span class="comment">//判断参数是否是输出参数</span></span><br><span class="line">	<span class="keyword">if</span> arg.Type().Dir() == DirOut &#123;</span><br><span class="line">		<span class="built_in">panic</span>(<span class="string">"getting data of output data arg"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> arg.data</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Group类型的参数"><a href="#Group类型的参数" class="headerlink" title="Group类型的参数"></a>Group类型的参数</h4><p>Group类型的参数包括两类:结构体类型——StructType和数组类型——ArrayType<br>当Group类型是结构体类型时,Inner用来表示结构体中的成员<br>当Group类型是数组类型时,Inner来表示数组元素<br>实际上可以把结构体类型当成数组类型只是每个数组元素是不同的参数类型也相当于一个切片数组<br>prog/prog.go中定义</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> GroupArg <span class="keyword">struct</span> &#123;</span><br><span class="line">	ArgCommon</span><br><span class="line">	Inner []Arg             <span class="comment">//切片数组:结构体成员或者数组元素</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>实现Group参数类型的Size()方法——返回Group类型的大小<br>对于结构体类型参数,需要循环遍历结构体的每个成员依次获取相应成员的大小然后计算出结构体大小总和<br>对于数组类型参数,需要循环遍历数组元素,统计总的数组元素的大小之和<br>prog/prog.go中定义</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(arg *GroupArg)</span> <span class="title">Size</span><span class="params">()</span> <span class="title">uint64</span></span> &#123;</span><br><span class="line">	typ0 := arg.Type()</span><br><span class="line">	<span class="keyword">if</span> !typ0.Varlen() &#123;</span><br><span class="line">		<span class="keyword">return</span> typ0.Size()</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//判断参数类型</span></span><br><span class="line">	<span class="keyword">switch</span> typ := typ0.(<span class="keyword">type</span>) &#123;</span><br><span class="line">	<span class="comment">//结构体类型</span></span><br><span class="line">	<span class="keyword">case</span> *StructType:</span><br><span class="line">		<span class="keyword">var</span> size <span class="keyword">uint64</span></span><br><span class="line">		<span class="comment">//循环遍历结构体的每一个成员</span></span><br><span class="line">		<span class="keyword">for</span> _, fld := <span class="keyword">range</span> arg.Inner &#123;</span><br><span class="line">			<span class="keyword">if</span> !fld.Type().BitfieldMiddle() &#123;</span><br><span class="line">				<span class="comment">//求和</span></span><br><span class="line">				size += fld.Size()</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> typ.AlignAttr != <span class="number">0</span> &amp;&amp; size%typ.AlignAttr != <span class="number">0</span> &#123;</span><br><span class="line">			<span class="comment">//求和</span></span><br><span class="line">			size += typ.AlignAttr - size%typ.AlignAttr</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//返回该结构体类型的大小</span></span><br><span class="line">		<span class="keyword">return</span> size</span><br><span class="line">	<span class="comment">//数组类型	</span></span><br><span class="line">	<span class="keyword">case</span> *ArrayType:</span><br><span class="line">		<span class="keyword">var</span> size <span class="keyword">uint64</span></span><br><span class="line">		<span class="comment">//循环遍历数组元素</span></span><br><span class="line">		<span class="keyword">for</span> _, elem := <span class="keyword">range</span> arg.Inner &#123;</span><br><span class="line">			<span class="comment">//计算数组总的大小——求和</span></span><br><span class="line">			size += elem.Size()</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//返回数组类型的大小</span></span><br><span class="line">		<span class="keyword">return</span> size</span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		<span class="built_in">panic</span>(fmt.Sprintf(<span class="string">"bad group arg type %v"</span>, typ))</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Union类型的参数"><a href="#Union类型的参数" class="headerlink" title="Union类型的参数"></a>Union类型的参数</h4><p>Union类型的参数定义:共用体、联合类型<br>prog/prog.go中定义</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> UnionArg <span class="keyword">struct</span> &#123;</span><br><span class="line">	ArgCommon</span><br><span class="line">	Option Arg          <span class="comment">//共用体类型实际参数类型</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Union类型参数实现Size()——返回参数大小(返回当前共用体类型参数的大小)</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(arg *UnionArg)</span> <span class="title">Size</span><span class="params">()</span> <span class="title">uint64</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> !arg.Type().Varlen() &#123;</span><br><span class="line">		<span class="keyword">return</span> arg.Type().Size()</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//返回当前共用体参数类型的大小</span></span><br><span class="line">	<span class="keyword">return</span> arg.Option.Size()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Resource类型的参数"><a href="#Resource类型的参数" class="headerlink" title="Resource类型的参数"></a>Resource类型的参数</h4><h5 id="ResultArg类型的参数"><a href="#ResultArg类型的参数" class="headerlink" title="ResultArg类型的参数"></a>ResultArg类型的参数</h5><p>资源类型的参数:kernel中Resource要么是一个常量值,要么是引用另外的一个Resource,或者是通过别的调用返回的值<br>资源类型的参数需要模拟引用,当资源类型的参数是某个系统调用返回时是ResultArg类型的参数,当资源类型的参数被别的资源类参数引用时,需要引用+1,资源类型的参数封装了一个map(键:参数,值:bool)用来表示资源类型的参数是否被使用<br>prog/prog.go中定义</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> ResultArg <span class="keyword">struct</span> &#123;</span><br><span class="line">	ArgCommon</span><br><span class="line">	Res   Arg                       <span class="comment">//当Resource类型的参数是引用另外的Resource时,Res代表引用的Resource参数</span></span><br><span class="line">	OpDiv <span class="keyword">uint64</span>                    <span class="comment">//-1</span></span><br><span class="line">	OpAdd <span class="keyword">uint64</span>                    <span class="comment">//+1</span></span><br><span class="line">	Val   <span class="keyword">uint64</span>                    <span class="comment">//Res引用计数</span></span><br><span class="line">	uses  <span class="keyword">map</span>[Arg]<span class="keyword">bool</span>             <span class="comment">//map,用来表示资源是否被ArgResult参数使用</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>实现资源类型参数接口Size()——返回资源类型参数大小<br>prog/prog.go中定义</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(arg *ResultArg)</span> <span class="title">Size</span><span class="params">()</span> <span class="title">uint64</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> arg.typ.Size()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>实现资源类型参数的Used()方法——返回map,便于查看使用该资源的参数<br>prog/prog.go中定义</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(arg *ResultArg)</span> <span class="title">Used</span><span class="params">()</span> *<span class="title">map</span>[<span class="title">Arg</span>]<span class="title">bool</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;arg.uses</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>实现资源类型的的Uses()方法——此时的资源参数是引用别的资源参数,返回引用的资源参数<br>prog/prog.go中定义</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(arg *ResultArg)</span> <span class="title">Uses</span><span class="params">()</span> *<span class="title">Arg</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;arg.Res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="ReturnArg类型参数"><a href="#ReturnArg类型参数" class="headerlink" title="ReturnArg类型参数"></a>ReturnArg类型参数</h5><p>ReturnArg类型参数是系统调用的返回值,包含:ResourceType类型的参数和VmaType类型的参数<br>prog/prog.go中定义</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> ReturnArg <span class="keyword">struct</span> &#123;</span><br><span class="line">	ArgCommon</span><br><span class="line">	uses <span class="keyword">map</span>[Arg]<span class="keyword">bool</span>               <span class="comment">//map,用来表示资源是否被ArgResult参数使用</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>实现ReturnArg类型参数接口Size()——返回资源类型参数大小<br>prog/prog.go中定义</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(arg *ReturnArg)</span> <span class="title">Size</span><span class="params">()</span> <span class="title">uint64</span></span> &#123;</span><br><span class="line">	<span class="built_in">panic</span>(<span class="string">"not called"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>实现资源类型参数的Used()方法——返回map,便于查看使用该资源的参数<br>prog/prog.go中定义</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(arg *ReturnArg)</span> <span class="title">Used</span><span class="params">()</span> *<span class="title">map</span>[<span class="title">Arg</span>]<span class="title">bool</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;arg.uses</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="系统调用总结"><a href="#系统调用总结" class="headerlink" title="系统调用总结"></a>系统调用总结</h3><p>描述一个系统调用需要包含系统调用号、系统调用名以及系统调用使用的参数个数、每个参数的类型和参数的值，最后还有系统调用的返回值类型和返回值等。<br>这里把系统调用封装在Call类型中,包含了系统调用描述Syscall(包含系统调用名称、系统调用号、系统调用参数类型的切片数组和系统调用返回值类型等信息)、系统调用参数切片数组(用来获取系统调用参数的值和大小等)、系统调用返回值(值和大小),这样一个完整的系统调用便成型了,包含了一个系统调用所有的信息。<br>而参数最重要的是参数个数,每一个参数类型,参数的值,所以对于不同参数类型进行了相应的定义和实现,如Const类型的参数、结构体类型的参数和数组参数、资源参数等。</p>
</the>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://0x9k.club/posts/uncategorized/2018-05-02-syzkaller_source_read_syscall_type_and_function.html" data-id="cjhyv9x0u00066cubk2zi6rck" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/fuzzer/">fuzzer</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/syzkaller/">syzkaller</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/posts/uncategorized/2018-05-02-syzkaller_source_read_target_type_and_function.html" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          syzkaller_source_read_target_type_and_function
        
      </div>
    </a>
  
  
    <a href="/posts/uncategorized/2018-05-02-syzkaller_source_read_rand_type_and_function.html" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">syzkaller_source_read_rand_type_and_function</div>
    </a>
  
</nav>

  
</article>


  
  <!-- 来必力City版安装代码 -->
<div id="lv-container" data-id="city" data-uid="MTAyMC8zMzM5MC85OTQ2">
    <script type="text/javascript">
   (function(d, s) {
       var j, e = d.getElementsByTagName(s)[0];

       if (typeof LivereTower === 'function') { return; }

       j = d.createElement(s);
       j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
       j.async = true;

       e.parentNode.insertBefore(j, e);
   })(document, 'script');
    </script>
<noscript> 为正常使用来必力评论功能请激活JavaScript</noscript>
</div>
<!-- City版安装代码已完成 -->

  



</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/kernel/">kernel</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/anltr4/">anltr4</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cve-2013-6282/">cve-2013-6282</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/exploit/">exploit</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fuzzer/">fuzzer</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kernel/">kernel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/syzkaller/">syzkaller</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tools/">tools</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/anltr4/" style="font-size: 10px;">anltr4</a> <a href="/tags/cve-2013-6282/" style="font-size: 10px;">cve-2013-6282</a> <a href="/tags/exploit/" style="font-size: 10px;">exploit</a> <a href="/tags/fuzzer/" style="font-size: 20px;">fuzzer</a> <a href="/tags/kernel/" style="font-size: 15px;">kernel</a> <a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/syzkaller/" style="font-size: 20px;">syzkaller</a> <a href="/tags/tools/" style="font-size: 10px;">tools</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/posts/uncategorized/2018-05-15-toy_to_anltr4_for_scan_deserialization_vuln.html">toy_to_antlr4_for_scan_deserialization_vuln</a>
          </li>
        
          <li>
            <a href="/posts/uncategorized/2018-05-14-syzkaller_source_read_generate_system_calls.html">syzkaller_source_read_generate_system_calls</a>
          </li>
        
          <li>
            <a href="/posts/kernel/2018-05-02-cve_2013_6282_analysis.html">CVE-2013-6282-analysis</a>
          </li>
        
          <li>
            <a href="/posts/uncategorized/2018-05-02-syzkaller_source_read_target_type_and_function.html">syzkaller_source_read_target_type_and_function</a>
          </li>
        
          <li>
            <a href="/posts/uncategorized/2018-05-02-syzkaller_source_read_syscall_type_and_function.html">syzkaller_source_read_syscall_type_and_function</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 0x9k<br>
      Powered by <a href="https://0x9k.club/" target="_blank">0x9k</a>
    </div>
 <!--统计start-->
      <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
      </script>
      <span id="busuanzi_container_site_pv">
    本站总访问量<span id="busuanzi_value_site_pv"></span>次
  </span>
      <span id="busuanzi_container_site_uv">
  总访客数<span id="busuanzi_value_site_uv"></span>人次
  </span>
      <!--统计end-->
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>